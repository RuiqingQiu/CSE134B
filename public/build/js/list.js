function deleteHabit(e){var t=Parse.Object.extend("Habit"),i=new Parse.Query(t);i.get(e,{success:function(e){e.destroy({success:function(e){location.reload()},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})}function listHabits(){var e=Parse.Object.extend("Habit"),t=new Parse.Query(e),i=Parse.User.current();t.equalTo("user_id",i),t.find({success:function(e){for(var t=0;t<e.length;t++){var i={};i.id=e[t].id,i.title=e[t].get("title"),i.icon_image=e[t].get("icon_image"),i.daily_current=e[t].get("daily_current"),i.daily_frequency=e[t].get("daily_frequency"),i.current_value=e[t].get("current_value"),console.log("current_value:"+i.current_value),i.max_value=e[t].get("max_value"),i.max_value>0?i.progress=i.current_value/i.max_value*CONST.PROGRESS_BAR_LENGTH:i.progress=0,HABIT.jsonArray[t]=i}renderHBTemplate($("#list-template"),HABIT.jsonArray,$("#habit-list"));for(var a=0;a<HABIT.jsonArray.length;a++)setInterval(notifyHabit,CONST.REPEAT_TIME,HABIT.jsonArray[a]);$(".habit-entry .edit").click(function(e){e.preventDefault();var t=$(this).closest(".habit-entry").attr("id");editHabit(t)}),$(".habit-entry .del").click(function(e){e.preventDefault();var t=$(this).closest(".habit-entry");$("#deleteConfirmation em").text($(t).find(".habit-name").text());var i=$(t).attr("id");$("#deleteConfirmation .btn-delete").click(function(e){e.preventDefault(),deleteHabit(i)})}),$(".habit-entry .op-skip").click(function(e){e.preventDefault();$(this).closest(".habit-entry");$(this).closest(".habit-entry").css({filter:"grayscale(100%)","-webkit-filter":"grayscale(100%)","-moz-filter":"grayscale(100%)","-ms-filter":"grayscale(100%)","-o-filter":"grayscale(100%)","-webkit-filter":"grayscale(1)"})}),$(".habit-entry .op-done").click(function(e){e.preventDefault();var t=$(this).closest(".habit-entry");doHabit($(t))}),$(".habit-entry .op-skip").click(function(e){e.preventDefault();var t=$(this).closest(".habit-entry");$(t).find(".message-today").css("visibility","visible")})},error:function(e){alert("Error: "+e.code+" "+e.message)}})}function doHabit(e){var t=Parse.Object.extend("Habit"),i=new Parse.Query(t);i.get($(e).attr("id"),{success:function(t){var i=t.get("daily_current"),a=t.get("daily_frequency");if(a>i)t.set("daily_current",++i),t.save({success:function(t){var r=$(e).find(".message-today");if(r.children(".daily-current").text(i),r.css("visibility","visible"),i==a){var n=$(e).find("max_value").text(),s=$(e).find("current_value").text();t.set("current_value",++s),s>n&&t.set("max_value",++n),t.save({success:function(t){$(e).find(".current-value").text(s),n==s&&(console.log("max:"+n),$(e).find(".max-value").text(n)),$(e).find(".progress").attr("x2",0!=n?s/n*CONST.PROGRESS_BAR_LENGTH:0);var i={user_id:Parse.User.current().id,title:t.get("title"),type:"Doing Habit"};Parse.Analytics.track("doingHabit",i)},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})}},error:function(e,t){alert("Error: "+t.code+" "+t.message)}});else{var r=$(e).find(".message-today");r.children(".daily-current").text(i),r.css("visibility","visible")}},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})}function editHabit(e){location.href="edit.html?objectID="+e}function notifyHabit(e){$.notify({icon:e.icon_image._url,title:e.title,message:"Did you do you the habit <em>"+e.title+"</em>",target:$(e.id)},{newest_on_top:!0,placement:{from:"top",align:"right"},type:"minimalist",delay:5e3,icon_type:"image",showProgressbar:!0,template:"<div data-id="+e.id+' data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert"><img data-notify="icon" class="img-circle pull-left" alt="icon"><span data-notify="title">{1}</span><span data-notify="message">{2}</span><div style="margin-top:10px"><p id=test style="text-align:center;"><input class="addbutton notif-confirm" type="button" value="Confirm" onclick="doHabit('+e.id+');" data-notify="dismiss"><input class="addbutton notif-cancel" type="button" value="Cancel" style="margin-left:5px" data-notify="dismiss"></p></div></div>'})}function renderHBTemplate(e,t,i){var a=Handlebars.compile($(e).html());$(i).append(a(t))}var CONST={};CONST.PROGRESS_BAR_LENGTH=150,CONST.REPEAT_TIME=1e4;var HABIT={};HABIT.jsonArray=[],$(document).ready(function(){Parse.initialize("ULppY5RxxZUo8yekihZdVH3uHLm24j5Q6298Un4O","mDAyhkdhlv6qH9lT9WFzMCeML6ycMa1S8oWlybVG"),null==Parse.User.current()||null==Parse.User.current().authenticated()?window.location.href="login.html":listHabits()});